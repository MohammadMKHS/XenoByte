@model List<XenoByte.Models.Entity.RansomwareReport>
@{
    ViewData["Title"] = "Ransomware Reports";
    Layout = "_MainLayout";
}

<div class="container-fluid mt-4">
    <h2>Ransomware Reports</h2>
    <p class="text-muted">Total Reports: @Model.Count</p>

    <div class="table-responsive">
        <table class="table table-striped table-dark">
            <thead>
                <tr>
                    <th>ID</th>
                    <th>Bitcoin Addresses</th>
                    <th>Family</th>
                    <th>Demand</th>
                    <th>Reporter</th>
                    <th>Created At</th>
                    <th>Actions</th>
                </tr>
            </thead>
            <tbody>
                @foreach (var report in Model)
                {
                    <tr>
                        <td>@report.Id</td>
                        <td>
                            <div style="max-width: 200px; overflow: hidden; text-overflow: ellipsis;">
                                @report.BitcoinAddresses
                            </div>
                        </td>
                        <td>@(report.Family ?? "Unknown")</td>
                        <td>@(report.Demand ?? "Not specified")</td>
                        <td>@(report.User?.Username ?? report.ReporterEmail ?? "Anonymous")</td>
                        <td>@report.CreatedAt.ToString("yyyy-MM-dd HH:mm")</td>
                        <td>
                            <button class="btn btn-sm btn-info" onclick="viewDetails(@report.Id)">View</button>
                        </td>
                    </tr>
                }
            </tbody>
        </table>
    </div>
</div>

<!-- Modal for viewing report details -->
<div class="modal fade" id="reportModal" tabindex="-1">
    <div class="modal-dialog modal-lg">
        <div class="modal-content bg-dark text-light">
            <div class="modal-header">
                <h5 class="modal-title">Ransomware Report Details</h5>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body" id="modalContent">
                <!-- Content will be loaded here -->
            </div>
        </div>
    </div>
</div>

@section Scripts {
    <script>
        function viewDetails(reportId) {
            const report = @Html.Raw(Json.Serialize(Model));
            const selectedReport = report.find(r => r.id === reportId);
            
            if (selectedReport) {
                let content = `
                    <p><strong>ID:</strong> ${selectedReport.id}</p>
                    <p><strong>Bitcoin Addresses:</strong><br>${selectedReport.bitcoinAddresses}</p>
                    <p><strong>Family:</strong> ${selectedReport.family || 'Unknown'}</p>
                    <p><strong>Demand:</strong> ${selectedReport.demand || 'Not specified'}</p>
                    <p><strong>Source Link:</strong> ${selectedReport.sourceLink ? `<a href="${selectedReport.sourceLink}" target="_blank">${selectedReport.sourceLink}</a>` : 'None'}</p>
                    <p><strong>Notes:</strong><br>${selectedReport.notes || 'None'}</p>
                    <p><strong>Reporter Email:</strong> ${selectedReport.reporterEmail || 'Not provided'}</p>
                    <p><strong>Created At:</strong> ${new Date(selectedReport.createdAt).toLocaleString()}</p>
                `;
                
                if (selectedReport.paymentScreenshotPath) {
                    content += `<p><strong>Payment Screenshot:</strong><br><img src="/${selectedReport.paymentScreenshotPath}" class="img-fluid" style="max-height: 300px;"></p>`;
                }
                
                if (selectedReport.ransomNotePath) {
                    content += `<p><strong>Ransom Note:</strong><br><a href="/${selectedReport.ransomNotePath}" target="_blank">View File</a></p>`;
                }
                
                document.getElementById('modalContent').innerHTML = content;
                new bootstrap.Modal(document.getElementById('reportModal')).show();
            }
        }
    </script>
}